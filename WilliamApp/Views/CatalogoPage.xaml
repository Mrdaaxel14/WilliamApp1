<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WilliamApp.Views.CatalogoPage"
             x:Name="CatalogoPageRoot"
             Title="Catálogo"
             BackgroundColor="#F5F5F5">
    <RefreshView Command="{Binding RecargarCommand}" IsRefreshing="{Binding IsBusy}">
        <ScrollView>
            <VerticalStackLayout Padding="16" Spacing="16">

                <!-- Header -->
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="2">
                        <Label Text="Explorá nuestro catálogo"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="Black" />
                        <Label Text="Productos listos para agregar al carrito"
                               FontSize="14"
                               TextColor="#616161" />
                    </VerticalStackLayout>
                    <ActivityIndicator Grid.Column="1"
                                       IsRunning="{Binding IsBusy}"
                                       IsVisible="{Binding IsBusy}"
                                       Color="#FFD600"
                                       VerticalOptions="Center" />
                </Grid>

                <!-- Mensaje cuando no hay productos -->
                <Frame BackgroundColor="#FFFDE7" 
                       BorderColor="#FFD600" 
                       CornerRadius="12" 
                       Padding="12"
                       IsVisible="{Binding TieneProductos, Converter={StaticResource InverseBoolConverter}}">
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Sin productos"
                               FontAttributes="Bold"
                               TextColor="#F57F17" />
                        <Label Text="No hay productos disponibles en este momento. Desliza hacia abajo para reintentar."
                               TextColor="#424242" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Categorías con productos -->
                <CollectionView ItemsSource="{Binding Categorias}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="16" 
                                   Margin="0,0,0,16"
                                   BackgroundColor="White"
                                   BorderColor="#E0E0E0" 
                                   CornerRadius="12"
                                   HasShadow="True">
                                <VerticalStackLayout Spacing="12">
                                    <!-- Nombre de categoría -->
                                    <Label Text="{Binding NombreCategoria}" 
                                           FontAttributes="Bold" 
                                           FontSize="20"
                                           TextColor="#212121"/>

                                    <!-- Grid de productos (2 columnas) -->
                                    <CollectionView ItemsSource="{Binding Productos}">
                                        <CollectionView.ItemsLayout>
                                            <GridItemsLayout Orientation="Vertical" 
                                                           Span="2" 
                                                           HorizontalItemSpacing="12"
                                                           VerticalItemSpacing="12"/>
                                        </CollectionView.ItemsLayout>

                                        <CollectionView.ItemTemplate>
                                            <DataTemplate>
                                                <Frame BorderColor="#E0E0E0" 
                                                       CornerRadius="12" 
                                                       Padding="0"
                                                       HasShadow="False"
                                                       BackgroundColor="White">
                                                    <Frame.GestureRecognizers>
                                                        <TapGestureRecognizer Tapped="OnProductoTapped" />
                                                    </Frame.GestureRecognizers>

                                                    <Grid RowDefinitions="180,Auto">
                                                        <!-- Imagen del producto -->
                                                        <Frame Grid.Row="0" 
                                                               Padding="0" 
                                                               CornerRadius="12"
                                                               HasShadow="False"
                                                               BackgroundColor="#F5F5F5">
                                                            <Image Source="{Binding ImagenMostrar}"
                                                                   Aspect="AspectFill"
                                                                   HeightRequest="180"/>
                                                        </Frame>

                                                        <!-- Información del producto -->
                                                        <VerticalStackLayout Grid.Row="1" 
                                                                           Padding="12" 
                                                                           Spacing="4">
                                                            <Label Text="{Binding Descripcion}" 
                                                                   FontAttributes="Bold"
                                                                   FontSize="14"
                                                                   LineBreakMode="TailTruncation"
                                                                   MaxLines="2"/>
                                                            <Label Text="{Binding Marca}" 
                                                                   FontSize="12"
                                                                   TextColor="#757575"
                                                                   LineBreakMode="TailTruncation"/>
                                                            <Label Text="{Binding Precio, StringFormat='${0:N0}'}" 
                                                                   FontSize="16"
                                                                   FontAttributes="Bold"
                                                                   TextColor="#2E7D32"
                                                                   Margin="0,4,0,0"/>
                                                        </VerticalStackLayout>
                                                    </Grid>
                                                </Frame>
                                            </DataTemplate>
                                        </CollectionView.ItemTemplate>
                                    </CollectionView>
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>