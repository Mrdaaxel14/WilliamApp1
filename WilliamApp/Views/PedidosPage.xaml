<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WilliamApp.Views.PedidosPage"
             Title="Mis Compras"
             BackgroundColor="#F9F9F9">

    <Grid>
        <!-- Loading Indicator -->
        <ActivityIndicator IsRunning="{Binding IsLoading}"
                         IsVisible="{Binding IsLoading}"
                         Color="#FFD600"
                         VerticalOptions="Center"
                         HorizontalOptions="Center" />

        <!-- Content -->
        <RefreshView IsRefreshing="{Binding IsRefreshing}"
                    Command="{Binding RefreshCommand}"
                    RefreshColor="#FFD600">
            <CollectionView ItemsSource="{Binding Pedidos}" 
                          Margin="15,10,15,10">
                <CollectionView.EmptyView>
                    <VerticalStackLayout Padding="24" 
                                       Spacing="12" 
                                       VerticalOptions="Center" 
                                       HorizontalOptions="Center">
                        <Image Source="https://via.placeholder.com/150x150.png?text=ðŸ“¦"
                              WidthRequest="100"
                              HeightRequest="100"
                              Margin="0,0,0,10" />
                        <Label Text="AÃºn no tienes pedidos registrados" 
                              FontSize="20" 
                              FontAttributes="Bold" 
                              HorizontalTextAlignment="Center"
                              TextColor="#333333" />
                        <Label Text="Realiza una compra para ver tus pedidos aquÃ­." 
                              FontSize="14" 
                              TextColor="Gray" 
                              HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="0" 
                              Margin="0,5,0,10" 
                              CornerRadius="12" 
                              BorderColor="#E0E0E0"
                              BackgroundColor="White"
                              HasShadow="True">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.VerDetalleCommand}"
                                                    CommandParameter="{Binding}" />
                            </Frame.GestureRecognizers>
                            
                            <VerticalStackLayout Spacing="0">
                                <!-- Fecha del pedido -->
                                <Label Text="{Binding FechaFormateada}"
                                      FontSize="13"
                                      TextColor="#666666"
                                      Padding="15,12,15,8"
                                      FontAttributes="Bold" />
                                
                                <!-- LÃ­nea separadora -->
                                <BoxView HeightRequest="1" 
                                        BackgroundColor="#F0F0F0" 
                                        Margin="15,0,15,0" />
                                
                                <!-- Contenido principal del pedido -->
                                <Grid Padding="15,12,15,12" 
                                     ColumnDefinitions="80,*" 
                                     ColumnSpacing="12">
                                    
                                    <!-- Imagen del producto -->
                                    <Frame Grid.Column="0" 
                                          Padding="0" 
                                          CornerRadius="8" 
                                          BorderColor="#E0E0E0"
                                          HasShadow="False"
                                          WidthRequest="80"
                                          HeightRequest="80">
                                        <Image Source="{Binding ImagenPrincipal}"
                                              Aspect="AspectFill" />
                                    </Frame>
                                    
                                    <!-- InformaciÃ³n del pedido -->
                                    <VerticalStackLayout Grid.Column="1" 
                                                       Spacing="4" 
                                                       VerticalOptions="Center">
                                        
                                        <!-- Estado del pedido con badge -->
                                        <HorizontalStackLayout Spacing="6">
                                            <Frame Padding="6,3,6,3" 
                                                  CornerRadius="10" 
                                                  BackgroundColor="{Binding ColorEstado}"
                                                  HasShadow="False"
                                                  BorderColor="Transparent">
                                                <Label Text="{Binding EstadoPedido}"
                                                      FontSize="12"
                                                      TextColor="White"
                                                      FontAttributes="Bold" />
                                            </Frame>
                                        </HorizontalStackLayout>
                                        
                                        <!-- DescripciÃ³n del estado -->
                                        <Label Text="{Binding DescripcionEstado}"
                                              FontSize="13"
                                              TextColor="#666666" />
                                        
                                        <!-- Cantidad de productos -->
                                        <Label Text="{Binding CantidadItemsTexto}"
                                              FontSize="13"
                                              TextColor="#999999" />
                                        
                                        <!-- Total del pedido -->
                                        <Label Text="{Binding Total, StringFormat='Total: ${0:F2}'}"
                                              FontSize="15"
                                              FontAttributes="Bold"
                                              TextColor="#333333"
                                              Margin="0,4,0,0" />
                                    </VerticalStackLayout>
                                </Grid>
                                
                                <!-- LÃ­nea separadora inferior (opcional) -->
                                <BoxView HeightRequest="1" 
                                        BackgroundColor="#F0F0F0" 
                                        Margin="15,0,15,0" />
                                
                                <!-- BotÃ³n Volver a comprar (opcional) -->
                                <Button Text="Ver detalles"
                                       BackgroundColor="Transparent"
                                       TextColor="#FFD600"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       Padding="15,8,15,8"
                                       Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.VerDetalleCommand}"
                                       CommandParameter="{Binding}" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>

</ContentPage>
